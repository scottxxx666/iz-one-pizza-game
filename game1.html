<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<script src="//cdn.jsdelivr.net/npm/phaser@3.53.1/dist/phaser.min.js"></script>
<script>
  var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 400 },
        debug: false,
      },
    },
    scene: {
      preload: preload,
      create: create,
      update: update,
    },
  };

  var game = new Phaser.Game(config);

  function preload() {
    this.load.image('ground', 'assets/platform.png');
    this.load.image('star', 'assets/star.png');
    this.load.spritesheet('player', 'assets/dude.png', { frameWidth: 32, frameHeight: 48 });
  }

  var platforms;
  var player;

  var speed = 100;
  var stars;
  var score = 0;
  var scoreText;

  function create() {
    platforms = this.physics.add.staticGroup();
    platforms.create(0, 590, 'ground').setScale(4, 1).refreshBody();

    player = this.physics.add.sprite(400, 0, 'player');
    player.setCollideWorldBounds(true);

    stars = this.physics.add.group({
      key: 'star',
      repeat: 0,
      setXY: { x: 12, y: 0, stepX: 70 },
    });

    setInterval(() => {
      // stars.children.iterate(function (child) {
      //   child.enableBody(true, child.x, 0, true, true);
      // });
      // var bomb = stars.create(100, 160, 'bomb');
      // bomb.setVelocity(Phaser.Math.Between(-200, 200), 20);
      // bomb.allowGravity = false;
      for (let i = 0; i < 3 * Math.random(); i++) {
        var s = stars.create(Math.random() * 800, 0, 'star');
        // s.setVelocity(Phaser.Math.Between(-200, 200), Phaser.Math.Between(10, 200));
      }
    }, Phaser.Math.Between(1000, 3000));

    this.physics.add.collider(player, platforms);
    this.physics.add.collider(player, stars, eat, null, this);

    scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#FFF' });
  }

  function update() {
    const cursors = this.input.keyboard.createCursorKeys();
    if (cursors.left.isDown) {
      player.setVelocityX(-160);
      // speed -= 100;
      // console.log(speed);
      // player.setVelocityX(speed);
    } else if (cursors.right.isDown) {
      player.setVelocityX(160);
    } else {
      player.setVelocityX(0);
    }

    if (cursors.up.isDown && player.body.touching.down) {
      player.setVelocityY(-330);
    }
  }

  function eat(player, star) {
    // this.physics.pause();
    star.disableBody(true, true);
    score += 10;
    scoreText.setText('Score: ' + score);

    // player.setTint(0xff0000);
    // setTimeout(() => player.setTint(), 100);
  }
</script>
</body>
</html>
